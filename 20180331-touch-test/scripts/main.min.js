/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// MIT license

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/almond-0.2.6",function(){}),define("util/canvas",[],function(){function t(t,n){t.width!==n.width&&(t.width=n.width,e=!0),t.height!==n.height&&(t.height=n.height,e=!0),e&&(t.width=n.width,t.height=n.height),e=!1}function n(e,t){t.clearRect(t,0,0,e.width,e.height)}var e=!1;return{resize:t,clear:n}}),define("util/imagedata-contrast",[],function(){function o(o,u){n=parseInt(u,10)>1?parseInt(u,10):10,t=o.data.length,r=Infinity,i=0;for(e=0;e<t;e+=n*4)s=o.data[e]+o.data[e+1]+o.data[e+2],s<r&&(r=s),s>i&&(i=s);return(i-r)/765}var e,t,n=20,r,i,s;return o}),define("util/distort",["util/canvas","util/imagedata-contrast"],function(e,t){function l(t,i,s,o){f=o,r.clearRect(0,0,n.width,n.height),e.resize(n,t),c(t,i,s)}function c(e,t,i){u=t.length;var o=[];for(s=0;s<u;s++)h(r,e,t,t[s],i,o);f(r.getImageData(0,0,n.width,n.height),o)}function h(e,t,n,r,i,s){var o=v(n,"row",r.row+1,"column",r.column),u=v(n,"row",r.row,"column",r.column+1),a=v(n,"row",r.row+1,"column",r.column+1);if(r&&u&&o&&a){var f=p(0,0,r.x_end,i,0,u.x_end,0,i,o.x_end),l=p(0,0,r.y_end,i,0,u.y_end,0,i,o.y_end),c=p(i,i,a.x_end,i,0,u.x_end,0,i,o.x_end),h=p(i,i,a.y_end,i,0,u.y_end,0,i,o.y_end);e.save(),e.setTransform(f[0],l[0],f[1],l[1],f[2],l[2]),e.beginPath(),e.moveTo(-1,-1),e.lineTo(i+1,-1),e.lineTo(-1,i+1),e.lineTo(-1,-1),e.closePath(),e.clip(),f[0]!==l[1]?e.drawImage(t,r.x,r.y,i,i,-1,-1,i+1,i+1):e.drawImage(t,r.x,r.y,i,i,0,0,i,i),e.restore(),e.save(),s.push({points:[{x:r.x,y:r.y},{x:u.x,y:u.y},{x:o.x,y:o.y},{x:a.x,y:a.y}],transforms:{shape:{scaleX:f[0],skewX:l[0],scaleY:f[1],skewY:l[1],translateX:f[2],translateY:l[2]},image:{scaleX:c[0],skewX:h[0],scaleY:c[1],skewY:h[1],translateX:c[2],translateY:h[2]}}}),e.setTransform(c[0],h[0],c[1],h[1],c[2],h[2]),e.beginPath(),e.moveTo(i,i),e.lineTo(i,0),e.lineTo(i-1,0),e.lineTo(-1,i),e.lineTo(0,i),e.lineTo(i,i),e.closePath(),e.clip(),c[0]!==h[1]?e.drawImage(t,r.x,r.y,i,i,-1,-1,i+1,i+1):e.drawImage(t,r.x,r.y,i,i,0,0,i,i),e.restore()}}function p(e,t,n,r,i,s,o,u,a){e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),o=parseFloat(o),u=parseFloat(u),a=parseFloat(a);var f=((s-a)*(t-i)-(n-s)*(i-u))/((r-o)*(t-i)-(e-r)*(i-u)),l=((s-a)*(e-r)-(n-s)*(r-o))/((i-u)*(e-r)-(t-i)*(r-o)),c=n-e*f-t*l;return[f,l,c]}function d(e,t,n){var r=[],i=0,s=0,o=0,u=e.width,a=e.height,f=0,l=0;for(s=0;s<a;s+=n){f=0;for(o=0;o<u;o+=t)s+t<u&&o+n<a&&(r[i]={x:s,y:o,column:f,row:l,data_index:(s*u+o)*4},i++),f++;l++}return r.rows=l,r.columns=f,r}function v(e,t,n,r,i){var s;a=e.length;for(o=0;o<a;o++)if(e[o][t]===n&&e[o][r]===i){s=e[o];break}return s}var n=document.createElement("canvas"),r=n.getContext("2d"),i={x:0,y:1},s,o,u,a,f;return l}),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("lib/raf",function(){}),define("src/process",["util/distort","util/canvas","lib/raf"],function(e,t){function l(e){u=e.signals,u["image-loaded"].add(p),u["points-updated"].add(h),u["control-updated"].add(c),u["image-data-url-requested"].add(y)}function c(e){s=b(e),v()}function h(e){f=e,v()}function p(e){i||(o=e,m(o))}function d(){i||requestAnimationFrame(v),i=!0}function v(){o?m(o):i=!1}function m(r){i=!0,t.resize(n,r),o&&f&&s&&e(o,f,s.gridsize,g)}function g(e,s){r.clearRect(0,0,n.width,n.height),t.resize(n,e),r.putImageData(e,0,0),i=!1,e=null,s&&u["data-updated"].dispatch(s)}function y(e){typeof e=="function"&&e(n.toDataURL("image/png"))}function b(e){var t={};for(var n in e)t[n]=parseInt(e[n],10);return n=null,t}var n=document.getElementById("image-canvas"),r=n.getContext("2d"),i=!1,s,o,u,a,f;return{init:l}}),define("util/collection",[],function(){function r(r,s,o,u,a){n=undefined,e=r.length,t=0;for(t=0;t<e;t++)if(r[t][s]===o&&r[t][u]===a){n=r[t];break}return n}var e,t,n;return{getItemByValue:r}}),define("util/feature-test",[],function(){function t(t,n){var r=!0,i={},s=[];for(var o in e){var u=e[o].test();u||e[o].required&&(r=!1,s.push(o)),i[o]=u}r?t(i):n(s,i)}var e={canvas:{required:!0,test:function(){return!!document.createElement("canvas").getContext}},"query-selector-all":{required:!1,test:function(){return!!document.querySelectorAll}},"drag-drop":{required:!1,test:function(){return"draggable"in document.createElement("span")}},"file-api":{required:!1,test:function(){return typeof FileReader!="undefined"}},touch:{required:!1,test:function(){return"ontouchstart"in document.documentElement}}};return t}),define("src/grid-canvas",["util/canvas","util/collection","util/feature-test"],function(e,t,n){function g(e){r=e.signals,i=document.getElementById("grid-canvas"),s=i.getContext("2d"),D(),y(),r["control-updated"].add(b),r["image-loaded"].add(_),r["image-loaded"].add(D),r["image-loaded"].add(A)}function y(){n(function(e){e.touch?(p=!0,i.addEventListener("touchstart",w),i.addEventListener("touchend",S),m=document.createElement("button"),m.classList.add("button"),m.textContent="Toggle Grid",m.addEventListener("click",M),document.querySelector(".light-bg .content").appendChild(m)):(i.addEventListener("mousedown",x),i.addEventListener("mousemove",N),i.addEventListener("mouseup",T),i.addEventListener("mouseout",k),i.addEventListener("mouseover",C))})}function b(e){e.gridsize!==h&&(h=parseInt(e.gridsize,10),D(),A())}function w(e){d||(d=!0,e.changedTouches&&e.changedTouches.length&&e.changedTouches[0]&&(v=e.changedTouches[0].identifier,i.addEventListener("touchmove",E),x(e.changedTouches[0])))}function E(e){if(d&&e.changedTouches&&e.changedTouches.length)for(var t=0,n=e.changedTouches.length;t<n;++t)if(e.changedTouches[t]&&e.changedTouches[t].identifier===v){N(e.changedTouches[t]);break}}function S(e){if(d&&e.changedTouches&&e.changedTouches.length)for(var t=0,n=e.changedTouches.length;t<n;++t)if(e.changedTouches[t]&&e.changedTouches[t].identifier===v){d=null,v=null,T(e.changedTouches[t]);break}}function x(e){u=!0,L(e)}function T(e){u=!1,L(e)}function N(e){L(e)}function C(e){f=!0}function k(){f=!1,u=!1,A()}function L(e){c=l;if(typeof e.offsetX!="undefined"&&typeof e.offsetY!="undefined")l.x=e.offsetX,l.y=e.offsetY;else{var t=e.target.getBoundingClientRect(),n=e.pageX-t.left,r=e.pageY-t.top;l.x=n,l.y=r}A()}function A(){a=H(o,l),f&&u&&(a.x_end=l.x,a.y_end=l.y,r["points-updated"].dispatch(o)),s.clearRect(0,0,i.width,i.height),O(s,o),a&&f&&(s.beginPath(),s.fillStyle="#0066ff",s.lineWidth=3,s.strokeStyle="#cccccc",s.arc(a.x_end,a.y_end,4,0,Math.PI*2,!0),s.stroke(),s.fill(),s.closePath())}function O(e,n){var r,i,s,o;for(var u=0;u<n.length;u++)r=n[u],i=t.getItemByValue(n,"row",r.row+1,"column",r.column),s=t.getItemByValue(n,"row",r.row,"column",r.column+1),o=t.getItemByValue(n,"row",r.row+1,"column",r.column+1),r&&i&&s&&o&&(e.beginPath(),e.moveTo(r.x_end,r.y_end),e.lineTo(s.x_end,s.y_end),e.lineTo(o.x_end,o.y_end),e.lineTo(i.x_end,i.y_end),e.lineTo(r.x_end,r.y_end),f?e.lineWidth=.4:e.lineWidth=.1,e.strokeStyle="#000000",e.stroke(),e.closePath())}function M(){f=!f,m&&m.classList[f?"add":"remove"]("is-active"),A()}function _(t){e.resize(i,t)}function D(){o=P(),r["points-updated"].dispatch(o)}function P(){var e=[],t=0,n=0,r=0,s=0,o=0,u=i.width,a=i.height;for(s=0;s<u;s+=h){n=0;for(o=0;o<a;o+=h)e[r]={x:s,y:o,x_end:s,y_end:o,column:t,row:n,index:r},r++,n++;t++}return e}function H(e,t){var n=0,r=e.length,i=Infinity,s=Infinity,o;for(n=0;n<r;n++)s=B({x:e[n].x_end,y:e[n].y_end},t),s<i&&(i=s,o=e[n]);return o}function B(e,t){var n=0,r=0;return n=t.x-e.x,n*=n,r=t.y-e.y,r*=r,Math.sqrt(n+r)}var r,i,s,o=[],u,a,f=!1,l={x:0,y:0},c=l,h=50,p=!1,d=!1,v=null,m=null;return{init:g}}),define("src/image",[],function(){function i(n){e=n.signals,t=new Image,e["set-new-src"].add(o),t.addEventListener("load",s,!1),o(r)}function s(){e["image-loaded"].dispatch(t),n=!0}function o(e){t.src=e,n&&t.naturalWidth!==undefined&&t.naturalWidth!==0&&setTimeout(s,10)}var e,t,n=!1,r=document.body.getAttribute("data-defaultimage");return{init:i}}),define("src/file",[],function(){function i(r){e=r.signals,n=r.feature,n["file-api"]&&(e["load-file"].add(s),t=new FileReader,t.addEventListener("load",o,!1))}function s(e){e&&e.type&&r.indexOf(e.type)!==-1&&t.readAsDataURL(e)}function o(t){e["set-new-src"].dispatch(t.target.result)}var e,t,n,r=["image/png","image/jpg","image/jpeg"];return{init:i}}),define("src/dragdrop",[],function(){function n(n){t=n.feature,e=n.signals,t["drag-drop"]&&(document.addEventListener("drop",i,!1),document.addEventListener("dragover",r,!1),document.addEventListener("dragleave",r,!1))}function r(e){e.preventDefault()}function i(t){t.preventDefault(),t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]&&(e["load-file"].dispatch(t.dataTransfer.files[0]),e["close-intro"].dispatch())}var e,t;return{init:n}}),define("src/controls",[],function(){function i(i){n=i.signals;if(i.feature["query-selector-all"]){var c=document.getElementById("controls");r=c.querySelectorAll(".control-input"),c.className+=" is-active";for(var h=0;h<r.length;h++){var p=r[h];p.addEventListener("input",s,!1),u(l(p.id),p.value),a(f(p.id),p.value)}t=!0,n["control-set"].add(o),n["control-updated"].dispatch(e)}}function s(e){e.target&&(e=e.target),u(l(e.id),e.value),a(f(e.id),e.value)}function o(t){var r,i={};for(var o in t)r=f(o),r.value=t[o],s(r),i[l(o)]=t[o];e=i,n["control-updated"].dispatch(e)}function u(r,i){e[r]=i,t&&n["control-updated"].dispatch(e)}function a(e,t){e.value!==t&&(e.value=t)}function f(e){var t,n=l(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s].id;if(i!==e&&i.indexOf(n)!==-1){t=r[s];break}}return t}function l(e){return e.replace("-slider","").replace("-number","")}var e={},t=!1,n,r;return{init:i}}),define("src/export-button",[],function(){function r(r){e=r.signals,t=document.getElementById("export-button"),n=document.getElementById("png-button"),t.addEventListener("click",i,!1),n.addEventListener("click",o,!1)}function i(t){t.preventDefault(),e["image-data-url-requested"].dispatch(s)}function s(e){n.href=e,n.classList.add("is-active")}function o(){n.classList.remove("is-active")}var e,t,n;return{init:r}}),define("util/trigger-event",[],function(){function e(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(e.nodeType!==9)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.fireEvent){var r=n.createEventObject();r.synthetic=!0,e.fireEvent("on"+t,r)}else if(e.dispatchEvent){var i="";switch(t){case"click":case"mousedown":case"mouseup":i="MouseEvents";break;case"focus":case"change":case"blur":case"select":i="HTMLEvents";break;default:throw"triggerEvent: Couldn’t find an event class for event "+t+"."}var r=n.createEvent(i),s=t=="change"?!1:!0;r.initEvent(t,s,!0),r.synthetic=!0,e.dispatchEvent(r)}}return e}),define("src/import-button",["util/trigger-event"],function(e){function a(e){n=e.signals,t=e.feature,t["file-api"]&&(s=new FileReader,r=document.getElementById("import-button"),i=document.getElementById("import-input"),r.addEventListener("click",f,!1),i.addEventListener("change",l,!1))}function f(t){t.preventDefault(),u||e(i,"click")}function l(e){var t=e.target.files;e.target&&e.target.files&&e.target.files[0]&&(n["load-file"].dispatch(e.target.files[0]),n["close-intro"].dispatch())}var t,n,r,i,s,o,u=!1;return{init:a}}),define("src/data-button",[],function(){function s(n){e=n.signals,t=document.getElementById("data-button"),i?n.signals["data-updated"].add(o):t.parentNode.removeChild(t)}function o(e){window.URL&&(clearTimeout(n),n=setTimeout(function(){r&&URL.revokeObjectURL(r);var n=new Blob([JSON.stringify(e,null,"	")],{type:"application/json"});r=URL.createObjectURL(n),t.href=r},200))}var e,t,n=NaN,r=null,i=!!window.URL&&!!window.Blob;return{init:s}}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("lib/reqwest",n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n.type=="jsonp"?handleJsonp(n,e,t,i):(o=xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),win[xDomainRequest]&&o instanceof win[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("src/upload-imgur",["lib/reqwest"],function(e,t){function h(e){n=e.signals,r=document.getElementById("imgur-button"),i=document.getElementById("imgur-url-container"),s=document.getElementById("imgur-url-input"),o=document.getElementById("imgur-url-link"),u=document.getElementById("imgur-url-error"),a=document.getElementById("twitter-link"),f=document.getElementById("facebook-link"),l=document.getElementById("reddit-link"),r.addEventListener("click",p,!1),s.addEventListener("click",d,!1)}function p(e){e.preventDefault(),c||(n["image-data-url-requested"].dispatch(v),i.classList.remove("is-active","upload-failed","upload-successful"))}function d(){s.select()}function v(t){c||(r.classList.add("is-uploading"),c=!0,e({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID a4c24380d884932"},data:{image:t.split(",")[1],type:"base64"},type:"json",crossOrigin:!0,success:m,error:g}))}function m(e){c=!1;if(e&&e.data&&e.data.link){var t="Check out what I made with @snorpey’s image distortion tool: ";t+=e.data.link,t+=" http://snorpey.github.io/distort-grid";var n="http://www.facebook.com/sharer.php?s=100";n+="&p[url]="+e.data.link,n+="&p[title]=BAAM!",n+="&p[images][0]="+e.data.link,n+="&p[summary]="+encodeURIComponent("Check out what I made with this image distortion tool: http://snorpey.github.io/distort-grid"),r.classList.remove("is-uploading"),s.setAttribute("value",e.data.link),o.href=e.data.link,i.classList.add("is-active","upload-successful"),a.href="https://twitter.com/intent/tweet?text="+encodeURIComponent(t),f.href=n,l.href="http://www.reddit.com/submit?url="+encodeURIComponent(e.data.link)}else g()}function g(e){c=!1,r.classList.remove("is-uploading"),i.classList.add("is-active","upload-failed")}var n,r,i,s,o,u,a,f,l,c=!1;return{init:h}}),define("src/intro",[],function(){function s(t){e=t.signals,r.addEventListener("click",o),i.addEventListener("click",a),e["close-intro"].add(a)}function o(e){t?a():u()}function u(){r.classList.add("is-active"),n.classList.add("is-active"),t=!0}function a(){r.classList.remove("is-active"),n.classList.remove("is-active"),t=!1}var e,t=!0,n=document.querySelectorAll(".intro")[0],r=document.querySelectorAll(".intro-button")[0],i=n.querySelectorAll(".close")[0];return{init:s}}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,typeof define=="function"&&define.amd?define("lib/signals-1.0.0",[],function(){return i}):typeof module!="undefined"&&module.exports?module.exports=i:e.signals=i}(this),requirejs.config({baseUrl:"scripts/",waitSeconds:5,urlArgs:"bust="+(new Date).getTime()}),require(["src/process","src/grid-canvas","src/image","src/file","src/dragdrop","src/controls","src/export-button","src/import-button","src/data-button","src/upload-imgur","src/intro","util/feature-test","lib/signals-1.0.0"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(c){var p={feature:c,signals:{"points-updated":new h,"load-file":new h,"image-loaded":new h,"set-new-src":new h,"control-set":new h,"control-updated":new h,"close-intro":new h,"image-data-url-requested":new h,"data-updated":new h}};e.init(p),t.init(p),i.init(p),s.init(p),o.init(p),u.init(p),a.init(p),n.init(p),r.init(p),f.init(p),l.init(p)}function d(e){var t=document.createElement("div"),n="sorry. it looks like your browser is missing some of the features ";n+="("+e.join(", ")+") that are required to run this ",n+="experiment.",t.innerText=n,t.className="missing-feature",document.getElementsByTagName("body")[0].appendChild(t)}c(p,d)}),define("main",function(){})})();